# å­˜å‚¨ä¼˜åŒ–æ–¹æ¡ˆ

## ðŸŽ¯ é—®é¢˜æè¿°

åŽŸæœ‰çš„ `__lru_access_records__` å­˜å‚¨æ–¹æ¡ˆå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

1. **ç©ºé—´å ç”¨å¤§**ï¼šéšç€å­˜å‚¨é¡¹å¢žåŠ ï¼Œè®¿é—®è®°å½•ä¹Ÿä¼šæ— é™å¢žé•¿
2. **æ•°æ®å†—ä½™**ï¼šJSONæ ¼å¼å­˜å‚¨åŒ…å«å¤§é‡é‡å¤çš„é”®åå’Œç»“æž„
3. **ç¼ºä¹è°ƒè¯•**ï¼šæ— æ³•ç›´è§‚æŸ¥çœ‹åŽ‹ç¼©æ•ˆæžœå’Œå­˜å‚¨ç»Ÿè®¡
4. **æ— å®¹é‡æŽ§åˆ¶**ï¼šæ²¡æœ‰é™åˆ¶è®¿é—®è®°å½•çš„æœ€å¤§æ•°é‡

## ðŸš€ ä¼˜åŒ–æ–¹æ¡ˆ

### 1. é«˜çº§åŽ‹ç¼©ç®—æ³•

#### åŽŸå§‹æ ¼å¼ vs ä¼˜åŒ–æ ¼å¼

**åŽŸå§‹æ ¼å¼ï¼ˆä½Žæ•ˆï¼‰ï¼š**
```json
{
  "user_data_123": {
    "lastAccess": 1703123456789,
    "accessCount": 5,
    "size": 1024
  },
  "cache_item_456": {
    "lastAccess": 1703123456790,
    "accessCount": 3,
    "size": 2048
  }
}
```

**ä¼˜åŒ–æ ¼å¼ï¼ˆé«˜æ•ˆï¼‰ï¼š**
```json
{
  "v": 2,
  "t": 1703123456790,
  "k": {
    "a": "user_data_123",
    "b": "cache_item_456"
  },
  "d": {
    "a": [1, 5, 1024],
    "b": [0, 3, 2048]
  }
}
```

#### åŽ‹ç¼©ç­–ç•¥

1. **ç‰ˆæœ¬æŽ§åˆ¶** (`v`): æ”¯æŒæ ¼å¼å‡çº§å’Œå‘åŽå…¼å®¹
2. **æ—¶é—´åŸºå‡†** (`t`): ä½¿ç”¨ç›¸å¯¹æ—¶é—´æˆ³ï¼Œå‡å°‘æ•°å­—å¤§å°
3. **é”®åæ˜ å°„** (`k`): å°†é•¿é”®åæ˜ å°„ä¸ºçŸ­æ ‡è¯†ç¬¦
4. **æ•°æ®åŽ‹ç¼©** (`d`): ä½¿ç”¨æ•°ç»„æ ¼å¼å­˜å‚¨æ•°å€¼

### 2. æ™ºèƒ½å®¹é‡æŽ§åˆ¶

```typescript
// é™åˆ¶æœ€å¤§è®°å½•æ•°ï¼Œé˜²æ­¢æ— é™å¢žé•¿
const maxEntries = 500;

// æŒ‰é‡è¦æ€§æŽ’åºï¼Œåªä¿ç•™æœ€é‡è¦çš„è®°å½•
const sortedEntries = Object.entries(records)
  .sort(([, a], [, b]) => {
    const weightA = a.lastAccess + (a.accessCount * 60000);
    const weightB = b.lastAccess + (b.accessCount * 60000);
    return weightB - weightA;
  })
  .slice(0, maxEntries);
```